!function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){factory(require("jquery"))}else{factory(jQuery)}}(function($){var defaults={className:"",text:"Drop a file",previewImage:true,value:null,classes:{main:"ezdz-dropzone",enter:"ezdz-enter",reject:"ezdz-reject",accept:"ezdz-accept",focus:"ezdz-focus"},validators:{maxSize:null,width:null,maxWidth:null,minWidth:null,height:null,maxHeight:null,minHeight:null},init:function(){},enter:function(){},leave:function(){},reject:function(){},accept:function(){},format:function(filename){return filename}};$.ezdz=function(element,options){this.settings=$.extend(true,{},defaults,$.ezdz.defaults,options);this.$input=$(element);var self=this,settings=self.settings,$input=self.$input;if(!$input.is('input[type="file"]')){$.error("Ezdz error - Must be apply to inputs type file.");return}if(!(window.File&&window.FileList&&window.FileReader)){return}var init=function(){var $ezdz,$container,value;$container=$('<div class="'+settings.classes.main+'" />').on("dragover.ezdz",function(){$(this).addClass(settings.classes.enter);if($.isFunction(settings.enter)){settings.enter.apply(this)}}).on("dragleave.ezdz",function(){$(this).removeClass(settings.classes.enter);if($.isFunction(settings.leaved)){settings.leaved.apply(this)}}).addClass(settings.className);$input.wrap($container).before("<div>"+settings.text+"</div>");$ezdz=$input.parent("."+settings.classes.main);value=settings.value||$input.data("value");if(value){self.preview(value)}if($.isFunction(settings.init)){settings.init.apply($input,[value])}$input.on("focus.ezdz",function(){$ezdz.addClass(settings.classes.focus)}).on("blur.ezdz",function(){$ezdz.removeClass(settings.classes.focus)}).on("change.ezdz",function(){var file=this.files[0];if(!file){return}var basename=file.name.replace(/\\/g,"/").replace(/.*\//,""),extension=file.name.split(".").pop(),formatted=settings.format(basename);file.extension=extension;var allowed=$input.attr("accept"),accepted=false;valid=true;errors={mimeType:false,maxSize:false,width:false,minWidth:false,maxWidth:false,height:false,minHeight:false,maxHeight:false};if(allowed){var types=allowed.split(/[,|]/);$.each(types,function(i,type){type=$.trim(type);if(file.type==type){accepted=true;return false}if(type.indexOf("/*")!==false){var a=type.replace("/*",""),b=file.type.replace(/(\/.*)$/g,"");if(a===b){accepted=true;return false}}});if(accepted===false){errors.mimeType=true}}else{accepted=true}$ezdz.removeClass(settings.classes.reject+" "+settings.classes.accept);if(accepted!==true){$input.val("");$ezdz.addClass(settings.classes.reject);if($.isFunction(settings.reject)){settings.reject.apply($input,[file,errors])}return false}var reader=new FileReader(file);reader.readAsDataURL(file);reader.onload=function(e){var img=new Image,isImage;file.data=e.target.result;img.src=file.data;setTimeout(function(){isImage=img.width&&img.height;if(settings.validators.maxSize&&file.size>settings.validators.maxSize){valid=false;errors.maxSize=true}if(isImage){file.width=img.width;file.height=img.height;if(settings.validators.width&&img.width!=settings.validators.width){valid=false;errors.width=true}if(settings.validators.maxWidth&&img.width>settings.validators.maxWidth){valid=false;errors.maxWidth=true}if(settings.validators.minWidth&&img.width<settings.validators.minWidth){valid=false;errors.minWidth=true}if(settings.validators.height&&img.height!=settings.validators.height){valid=false;errors.height=true}if(settings.validators.maxHeight&&img.height>settings.validators.maxHeight){valid=false;errors.maxHeight=true}if(settings.validators.minHeight&&img.height<settings.validators.minHeight){valid=false;errors.minHeight=true}}if(valid===true){$ezdz.find("img").remove();if(isImage&&settings.previewImage===true){$ezdz.find("div").html($(img).fadeIn())}else{$ezdz.find("div").html("<span>"+formatted+"</span>")}$ezdz.addClass(settings.classes.accept);if($.isFunction(settings.accept)){settings.accept.apply($input,[file])}}else{$input.val("");$ezdz.addClass(settings.classes.reject);if($.isFunction(settings.reject)){settings.reject.apply($input,[file,errors])}}},250)}})};init()};$.ezdz.prototype.preview=function(path,callback){var settings=this.settings,$input=this.$input,$ezdz=$input.parent("."+settings.classes.main);basename=path.replace(/\\/g,"/").replace(/.*\//,""),formatted=settings.format(basename);var img=new Image;img.src=path;img.onload=function(){$ezdz.find("div").html($(img).fadeIn());if($.isFunction(callback)){callback.apply(this)}};img.onerror=function(){$ezdz.find("div").html("<span>"+formatted+"</span>");if($.isFunction(callback)){callback.apply(this)}};$ezdz.addClass(settings.classes.accept)};$.ezdz.prototype.destroy=function(){var settings=this.settings,$input=this.$input;$input.parent("."+settings.classes.main).replaceWith($input);$input.off("*.ezdz");$input.data("ezdz","")};$.ezdz.prototype.options=function(options){var settings=this.settings;if(!options){return settings}$.extend(true,this.settings,options)};$.ezdz.prototype.container=function(){var settings=this.settings,$input=this.$input;return $input.parent("."+settings.classes.main)};$.ezdz.prototype.defaults=defaults;$.fn.ezdz=function(options){var args=arguments,plugin=$(this).data("ezdz");if(!plugin){return $(this).data("ezdz",new $.ezdz(this,options))}if(plugin[options]){return plugin[options].apply(plugin,Array.prototype.slice.call(args,1))}else{$.error("Ezdz error - Method "+options+" does not exist.")}}});